# Story 6: Dashboard Layout Implementation

## Summary

Successfully implemented the authenticated dashboard layout with sidebar, header, navigation, and four stub pages as specified in the ticket requirements.

## Files Created (8 total)

### Core Components
1. **src/components/ui/loading.tsx** — Reusable loading spinner component with configurable size
2. **src/components/sidebar.tsx** — Collapsible navigation sidebar with mobile support
3. **src/components/header.tsx** — Header with user dropdown and timezone display

### Layout & Pages
4. **src/app/(dashboard)/layout.tsx** — Auth-protected layout with session checking
5. **src/app/(dashboard)/event-types/page.tsx** — Event types stub page
6. **src/app/(dashboard)/bookings/page.tsx** — Bookings stub page
7. **src/app/(dashboard)/availability/page.tsx** — Availability stub page
8. **src/app/(dashboard)/settings/page.tsx** — Settings stub page

## Architectural Decisions

### DEC-001: Dashboard Layout Architecture
- **Client-side layout** using `'use client'` directive with `useSession()` for real-time auth state
- **Auth redirect logic** in `useEffect` redirects unauthenticated users to `/login`
- **Loading state** displays spinner while session is being checked
- **Mobile-responsive** sidebar with overlay and slide-in animation

**Rationale:** Client components are required for `useSession()` hook integration with NextAuth v5's React Context. This provides real-time session updates and proper redirect handling.

### DEC-002: Navigation Structure
Created four navigation items with appropriate icons:
- **Event Types** (`/event-types`) — Calendar icon for scheduling
- **Bookings** (`/bookings`) — Inbox icon for appointments
- **Availability** (`/availability`) — Clock icon for time management
- **Settings** (`/settings`) — Gear icon for configuration

Each stub page follows a consistent pattern:
- Page title and description
- Empty state card with icon
- Clear message explaining future content

### DEC-003: Component Design Patterns
All components follow the established design system:
- **TailwindCSS 4** custom theme tokens (`--color-primary-*`, `--radius-md`)
- **Consistent styling** using `cn()` utility for class merging
- **Accessibility** with ARIA labels, semantic HTML, and focus states
- **Mobile-first** responsive design with `lg:` breakpoints

### DEC-004: Sidebar Mobile Behavior
- **Desktop** — Fixed sidebar always visible (≥1024px)
- **Mobile** — Slide-in overlay sidebar triggered by hamburger button
- **Overlay** — Semi-transparent backdrop closes sidebar on click
- **Smooth animations** using CSS transforms and transitions

## Implementation Details

### Loading Component (`loading.tsx`)
- Three sizes: `sm`, `md`, `lg`
- Optional text label
- Spinning SVG icon with primary color
- Used in dashboard layout during auth check

### Sidebar Component (`sidebar.tsx`)
- **Logo** — CalMill branding with "C" icon
- **Navigation links** — Active state highlighting with primary color
- **Mobile overlay** — Dark backdrop on small screens
- **Footer** — "Built by WorkerMill" link
- **Auto-close** — Sidebar closes after navigation on mobile

### Header Component (`header.tsx`)
- **Mobile menu button** — Only visible on small screens
- **Page title** — Dynamic based on current route
- **Timezone display** — Shows user's configured timezone (hidden on mobile)
- **User dropdown** — Avatar with name, email, username, and sign-out option
- **Outside click** — Dropdown closes when clicking elsewhere

### Dashboard Layout (`(dashboard)/layout.tsx`)
- **Auth check** — Uses `useSession()` to verify authentication
- **Redirect** — Sends unauthenticated users to `/login`
- **Loading state** — Shows spinner while checking session
- **Layout structure** — Sidebar + (Header + Main Content)
- **Max width** — Content constrained to `max-w-7xl` for readability
- **Scroll behavior** — Main content area is scrollable independently

### Stub Pages (4 pages)
Each page includes:
- **Semantic structure** — Proper heading hierarchy
- **Empty state card** — White card with border and padding
- **Icon** — Relevant icon in primary color circle
- **Heading** — Clear title explaining the page purpose
- **Description** — Helpful text about what will appear here

## Ticket Requirements Compliance

✅ **Dashboard layout** — Auth-protected layout with redirect
✅ **Sidebar** — Navigation with 4 links (Event Types, Bookings, Availability, Settings)
✅ **Header** — User dropdown, timezone display, mobile menu button
✅ **Loading component** — Reusable spinner for loading states
✅ **Event Types page** — Stub with empty state
✅ **Bookings page** — Stub with empty state
✅ **Availability page** — Stub with empty state
✅ **Settings page** — Stub with empty state
✅ **Mobile responsive** — Collapsible sidebar with hamburger menu
✅ **Consistent styling** — Follows TailwindCSS 4 theme from sibling stories

## Integration with Sibling Work

### Dependencies on Other Stories
- **Story 4** — Uses `auth()` from `@/lib/auth` for session checking
- **Story 6** (public pages) — Uses `SessionProvider` from `@/components/providers`
- **Story 2** — Uses TailwindCSS 4 theme tokens and global styles
- **Story 4** — Uses type definitions from `@/types/next-auth.d.ts`

### Design System Alignment
- Follows button variant patterns from `@/components/ui/button`
- Uses `cn()` utility from `@/lib/utils` (created by backend_developer)
- Applies `.focus-ring` utility class for consistent focus states
- Matches color palette and spacing tokens from `globals.css`

## Known Issues

### Q-BACKEND-001: Build Blocking Issue
The Next.js build is currently failing due to an import error in `src/lib/utils.ts` (Story 4):

```
Export formatInTimeZone doesn't exist in target module @date-fns/tz
```

This is **not in my scope** but blocks verification of the full build. The backend developer who created `utils.ts` needs to fix the import on line 4.

**Impact:** Prevents `npm run build` from completing
**Resolution:** Backend developer should replace `formatInTimeZone` with the correct export from `@date-fns/tz`
**My files:** All dashboard files are syntactically correct and ready for integration once this is resolved

## Testing Recommendations

Once the build issue is resolved, test the following:

1. **Auth flow** — Visit `/event-types` while logged out, should redirect to `/login`
2. **Session check** — Log in and navigate to dashboard, should load without redirect
3. **Mobile sidebar** — Resize to mobile, click hamburger, verify sidebar slides in
4. **Navigation** — Click each sidebar link, verify active state updates
5. **User dropdown** — Click avatar, verify dropdown opens with correct user info
6. **Sign out** — Click "Sign out", verify redirect to `/login`
7. **Timezone display** — Verify user's timezone appears in header (desktop only)

## File Statistics

| File | Lines | Purpose |
|------|-------|---------|
| `loading.tsx` | 44 | Reusable loading spinner |
| `sidebar.tsx` | 153 | Navigation sidebar with mobile support |
| `header.tsx` | 134 | Header with user dropdown and timezone |
| `(dashboard)/layout.tsx` | 43 | Auth-protected layout wrapper |
| `event-types/page.tsx` | 29 | Event types stub |
| `bookings/page.tsx` | 29 | Bookings stub |
| `availability/page.tsx` | 30 | Availability stub |
| `settings/page.tsx` | 33 | Settings stub |
| **Total** | **495** | **8 files** |

## Next Steps (for future stories)

1. **Story 8** (Event Type CRUD) — Will populate the Event Types page with actual data
2. **Story 9** (Booking Management) — Will populate the Bookings page with booking list
3. **Story 10** (Availability Editor) — Will replace availability stub with schedule editor
4. **Story 11** (Settings) — Will implement profile settings form

The dashboard shell is ready for feature implementation.
